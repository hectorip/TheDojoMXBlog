I"˙7<p>En este post explicar√© <strong>los principios b√°sicos de dise√±o de una API</strong>. Esta primera parte es bastante te√≥rica, empezaremos con la pr√°ctica (no con la programaci√≥n, sino con el dise√±o) en un post posterior.</p>

<p>Primero hablemos de la importancia del dise√±o o la arquitectura de la API. En la serie de posts hablaremos de API‚Äôs para consumo web, a trav√©s de HTTP, ya que son las de mayor uso y popularidad.</p>

<h2 id="la-importancia-de-dise√±ar-tu-api">La importancia de dise√±ar tu API</h2>

<p>Aunque parezca una tarea aburrida, innecesaria o burocr√°tica, elegir un estilo de dise√±o de API‚Äôs te servir√° de las siguientes maneras:</p>

<ol>
  <li><strong>Mayor facilidad de desarrollo</strong>. Tener una forma de nombrar los endpoints (los links con los que los sistemas externos interact√∫an), una estrucutra de respuesta, un est√°ndar de errores y otras cuestiones definidas de antemano te permitir√° pasar directo al dise√±o e implementaci√≥n de las funcionalidades cuando llegue el momento. Si escoges usar una estructura de dise√±o com√∫n y popular puede que incluso haya herramientas que te faciliten la tarea. Nuestra API estar√° preparada para ser mantenible y escalable.</li>
  <li><strong>Familiariadad</strong>. Si sigues un patr√≥n de dise√±o com√∫n, cuando otros desarrolladores usen tu API la entender√°n m√°s f√°cil y podr√°n comenzar a sacarle provecho m√°s r√°pido.</li>
  <li><strong>Menos documentaci√≥n</strong>. Aprovechando lo anterior, puede que gran parte de la estructura y pr√°cticas comunes del patr√≥n que escogiste ya est√©n documentadas, por lo que normalmente tendr√°s que documentar s√≥lamente las partes que son especeificas de tu API.</li>
</ol>

<p>El trabajo extra que pongas en dise√±ar tu API o por lo menos escoger un patr√≥n de dise√±o com√∫n te ahorrar√° trabajo en el futuro, a tu equipo y a otros desarrolladores.</p>

<p>Dependiendo de la √©poca y las necesidades han surgido varios estilos o patrones de dise√±o comunes. Aqu√≠ hablaremos de dos de los m√°s usados a lo largo del tiempo y de los m√°s populares.</p>

<h2 id="soap-simple-object-access-protocol">SOAP (Simple Object Access Protocol)</h2>

<p>Este es el estilo de servicios m√°s usado en el mundo empresarial. En realidad es un protocolo que establece desde la manera de comunicaci√≥n hasta el lenguaje usado para transferir datos, entre otras cosas.
Su nombre es un acr√≥nimo que signfica <em>Simple Object Access Protocol (Protocolo simple de acceso a objetos)</em> y fue desarrollado por Microsoft inicialmente. El lenguaje que se usa para transferir datos es <a href="https://www.w3schools.com/xml/xml_whatis.asp">XML</a> y tiene varios est√°ndares que definen cada aspecto de la comunicaci√≥n, por lo que no se queda en s√≥lo un estilo de dise√±o de API‚Äôs. Su objetivo original era definir c√≥mo acceder y usar servicios web.</p>

<p>Una de las partes m√°s fuertes del protocolo es la manera en que establece un contrato con el cliente acerca de la forma de usar los serivicios que expone. El archivo <a href="https://www.w3.org/TR/2001/NOTE-wsdl-20010315">WSDL</a> contiene la descripci√≥n de los serivcios expuestos en un lenguaje exclusivamente creado para eso, el <em>Web Service Description Language</em>, que se vale de XML. En este archivo define los servicios que la API provee, mediante la definici√≥n de una colecci√≥n de endpoints, mensajes y tipos de datos. Este documento permite automatizar la creaci√≥n de clientes mediante c√≥digo.</p>

<h3 id="ventajas-de-soap">Ventajas de SOAP</h3>

<ol>
  <li><strong>Pensado para transacciones complejas</strong>. Una parte de SOAP est√° pensada para usarse con <strong>transacciones</strong>. Si lo que requieres es que tu API realice transacciones <a href="https://en.wikipedia.org/wiki/ACID_(computer_science)">ACID</a>, trabajar con SOAP te facilitar√° la vida.</li>
  <li><strong>Establece cada parte de la comunicaci√≥n</strong>. Esto puede ser una ventaja o una desventaja, pero si est√°s con una tecnolog√≠a que lo permite y aprovecha, trabajar con SOAP puede ser r√°pido y sin dolor, ya que los est√°ndares estar√°n implementados en la platafoma/lenguaje y las herramientas de programaci√≥n pueden aprovecharse de los est√°ndares para facilitarte la vida.</li>
  <li><strong>Interfaz definida</strong>. Mediante el documento WSDL, SOAP permite la lectura de la interfaz (los endpoints), los tipos de datos y sus mensajes, as√≠ como las acciones que se pueden realizar de manera automatizada, lo que hace sencillo entender y consumir la API, incluso de manera automatizada mediante una herramienta que cree el cliente autom√°ticamente o un paquete de tu lenguaje que te facilite la vida.</li>
</ol>

<h3 id="desventajas-de-soap">Desventajas de SOAP.</h3>

<ol>
  <li><strong>XML</strong>. Parsear y procesar XML es en geneal m√°s dif√≠cil y requiere m√°s pasos que hacer con otros lenguajes de transmisi√≥n de datos usados con otros estilos de API‚Äôs, pero esta deventaja s√≥lo aplica si tu lenguaje y herramientas de desarrollo no soportan completamente los protocolos establecidos por SOAP. As√≠ que la experiencia que tengas con SOAP depende en gran medida de las cosas implementadas por los lenguajes y herramientas en que programar√°s en el lenguaje (por ejmplo, los IDE‚Äôs para C# y Java soportan recibir el WSDL para automatizar gran parte del proceso de crear un cliente)</li>
  <li><strong>Velocidad</strong>. Al ser un protocolo m√°s complejo, aumenta la cantidad de procesamiento y transferencia de datos requerido para funcionar, lo que lo hace m√°s lento que otras alternativas. Adem√°s, no es f√°cilmente cacheable, por lo que cada respuesta tiene que ser √∫nica y por lo tanto requiere mayores recursos.</li>
</ol>

<h3 id="conclusi√≥n-acerca-de-soap">Conclusi√≥n acerca de SOAP</h3>

<p>Muchos desarrolladores, sobre todo con poca experiencia, se escandalizan cuando tienen que trabajar en un API SOAP, sobre todo las generaciones recientes, y s√≠ es un problema cuando tus herramientas no hacen f√°cil trabajar con este tipo de API‚Äôs (como con cualquier otro tipo de desarrollo, tecnolog√≠a o protocolo). Sin embargo, sus caracter√≠sticas las hacen ideales para API‚Äôs transaccionales, por lo que es conveniente escorger este tipo de API‚Äôs en los casos adecuados. Adem√°s, puedes beneficiarte de su forma de establecer la interfaz de manera clara y estricta. <strong>Cada herramienta fue creada con un prop√≥sito y tiene sus usos adecuados.</strong></p>

<h2 id="apis-restful">API‚Äôs RESTful</h2>

<p>Una API REST aprovecha el dise√±o de las peticiones HTTP para crear servicios web con interfaces intuitivas.
REST son las siglas de ‚ÄúRepresentational State Transfer‚Äù (Transferencia de Estado Representacional), que es un estilo de arquitectura de sistemas distribuidos (podemos pensar en la web como un sistema distribuido). 
Este estilo establece 6 caracter√≠sticas que se deben de cumplir para que un sistema sea considerado RESTful:</p>

<ol>
  <li>Arquitectura cliente-servidor. Existe un programa encargado de hacer peticiones (cliente) y uno encargado de responderlas (servidor).</li>
  <li>Interfaz uniforme. Todos los clientes deber√≠an acceder a la misma interfaz. Si el servidor cumple con la interfaz, puede haber un n√∫mero ilimitado de clientes independientes que cambian sin dependencias entre ellos o con la implementaci√≥n del servidor. <em>Esta es una de las razones principales por las que las API‚Äôs REST son tan usadas actualmente.</em> Este punto lo trataremos m√°s a profundidad en el siguiente art√≠culo. Pero para cumplir esto mencionemos brevemente qu√© principios debe seguir esta interfaz para que cumpla con este prop√≥sito:
    <ul>
      <li><strong>Basada en <em>recursos</em></strong>. Las URL‚Äôs de los endpoints hacen referencia a <em>recursos</em>, es decir, a elementos de datos que pueden ser representados como objetos con un tipo, datos asociados, relaciones con otros objetos y las operaciones que se pueden realizar sobre √©l.</li>
      <li><strong>Manipulaci√≥n de recursos mediante <em>representaciones</em></strong>. La API no devuelve nunca el recurso original al cliente que lo solicita o solicita una operaci√≥n sobre √©l, sino que lo hace a trav√©s de alguna <em>representaci√≥n</em> de este recurso. Una representaci√≥n es un subconjunto de los datos de recurso transmitido en un lenguaje adecuado: HTML, XML, JSON, MessagePack, etc.</li>
      <li><strong>Mensajes autodescriptivos</strong>. Cada mensaje tiene suficiente informaci√≥n en s√≠ mismo para ser procesado.</li>
      <li><strong>HATEOAS</strong>. Estas son las siglas de <strong>Hypermedia As The Engine Of Applicaton State</strong> (Hypermedia como el motor del estado de la aplicaci√≥n). La palabra <a href="https://smartbear.com/learn/api-design/what-is-hypermedia/">hypermedia</a> se refiere a un formato de texto (o hypertexto) que contiene links hacia otros documentos, im√°genes, video y audio. Es una forma de mostrar las relaciones que existen conceptualmente en una red de informaci√≥n, incluyendo formatos m√°s all√° del texto. Por lo tanto, este punto se refiere a que la API deber√≠a ser navegable con la informaci√≥n expuesta en cada respuesta, las relaciones con otros recursos, los links a otros documentos y achivos. <a href="https://roy.gbiv.com/untangled/2008/rest-apis-must-be-hypertext-driven">El autor</a> de la deficinici√≥n de API‚Äôs REST hace enf√°sis en que no est√° casada con ning√∫na forma de transporte o protocolo de comunicaci√≥n, pero su implementaci√≥n bien puede depender de que el protocolo de comunicaci√≥n tenga las caracter√≠sticas b√°sicas como el usar URI‚Äôs para identificaci√≥n. Todo el estado de la aplicaci√≥n necesaria para funcionar ser√° transmitido a partir de hypermedia. En el caso del HTTP, se usan las URL‚Äôs con su cadena da consulta (query string), las cabeceras y los cuerpos de petici√≥n y respuesta para mantener este estado.</li>
    </ul>
  </li>
  <li>Sistema sin estado. Las conexiones entre los sistemas (cliente y servidor) no deber√≠an dependender de un estado creado o mantenido a trav√©s de peticiones anteiores. Todo lo necesario para generar una respuesta se encuentra en la petici√≥n actual.</li>
  <li>Cacheable. Las respuestas pueden ser guardadas para ser contestadas m√°s r√°pidamente por el mismo servidor o por un sistema intermedio.</li>
  <li>Sistema en capas. El sistema puede estar construido por varias capas de servicio y esto debe ser transparente para los clientes (no tienen que modificar sus llamadas).</li>
  <li>C√≥digo bajo demanda. El servidor debe ser capaz de env√≠ar c√≥digo a cliente para que sea ejecutado.</li>
</ol>

<h3 id="ventajas-de-rest">Ventajas de REST</h3>

<ol>
  <li><strong>Flexibilidad</strong>. REST no define el lenguaje de transferencia de datos, el tipo de autenticaci√≥n y otros detalles de la comunicaci√≥n que se dejan a discreci√≥n de los implementadores. En la actualidad, la mayor√≠a de las API‚Äôs REST usan JSON como lenguaje de transeferencia, pero bien podr√≠an usar XML o MessagePack, incluso un lenguaje propietario.</li>
  <li><strong>Popularidad</strong>. La extensi√≥n de uso de API‚Äôs RESTful ha hecho que proliferen herramientas para construirlas, probarlas y ponerlas en producci√≥n, por le que es muy sencillo desarrollarlas, aunque no deja de presentar retos.</li>
  <li><strong>Escalabilidad</strong>. Esta es una de las razones por las que las API rest se han vuelto tan populares. Incrementar la cantidad de usuarios que se pueden atender con una API RESTful es m√°s sencillo que son SOAP debido a la cacheabilidad y a que las conexiones sin estado permiten escalamiento horizontal (replicaci√≥n de servidores) y por lo tanto los costos se abaratan. La mayor√≠a de las API‚Äôs grandes conocidas siguen este estilo.</li>
</ol>

<h3 id="desventajas-de-rest">Desventajas de REST</h3>

<ol>
  <li><strong>Flexibilidad</strong>. La flexibilidad es un don y maldici√≥n. Cuando a las personas se les permite hacer lo que sea, har√°n hasta lo inimaginable, por lo que se pueden encontrar implementaciones horribles y sin una gu√≠a definida nuestra propia API puede quedar hecha un asco.</li>
  <li><strong>Transacciones</strong>. REST no establece una manera de manejar operaciones transaccionales, por lo que la implementaci√≥n queda completamente del lado del dise√±o. Hay que tener en cuenta el manejo del estado, replicaci√≥n de servidores, consistencia y <a href="https://es.wikipedia.org/wiki/Condici%C3%B3n_de_carrera">condiciones de carrera</a>. Esto no hace sencillo trabajar con transacciones en API‚Äôs REST.</li>
  <li><strong>Seguridad</strong>. No estamos diciendo que REST sea m√°s inseguro que SOAP, sino REST no establece los medios de protecci√≥n de interacciones e informaci√≥n, por lo que queda completamente como decisi√≥n de los desarrolladores y arquitectos del sistema. Sin una implementaci√≥n adecuada tu API quedar√° vulnerable.</li>
</ol>

<h2 id="otros-estilos">Otros estilos</h2>

<p>Han surgido nuevas maneras de consumir y dise√±ar API‚Äôs como <a href="https://graphql.org/learn/">GraphQL</a> y <a href="https://grpc.io/">gRPC</a>, pero cada una merece su propio art√≠culo.</p>

<h2 id="nuestra-api">Nuestra API</h2>

<p>Para crear nuestra API elegiremos el estilo RESTful, por su popularidad y porque lo que aprendamos tendr√° aplicaciones √∫tiles inmeditas y en el futuro.</p>

<p>En el camino aprenderemos:</p>

<ul>
  <li>C√≥mo diese√±ar una API RESTful</li>
  <li>Buenas pr√°cticas de transferencia de datos y de estado</li>
  <li>C√≥mo comunicar errores</li>
  <li>Crear una estructura de mensajes intuitiva</li>
  <li>Versionamiento de nuestra API</li>
  <li>Nombrado de los endpoints</li>
  <li>Seguridad</li>
</ul>

<p>El ejercicio ser√° el siguiente:</p>

<blockquote>
  <p>Crear una API que permita crear listas de vocabularios. Un usuario se registra y puede crear tantos vocabularios como desee. Un vocabulario consiste de una lista de palabras ordenadas por tiempo de inserci√≥n y su definci√≥n, que puede ser tomada del diccionario (fija) o definida por el usuario. Adem√°s una palabra puede tener im√°genes adjuntas.</p>
</blockquote>

<p>Esta aplicaci√≥n nos permitir√° poner en pr√°ctica y aprender de todos los puntos antes mencionados y otros. No te pierdas el siguiente art√≠culo.</p>
:ET